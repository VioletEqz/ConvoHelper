<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üó®Ô∏è ConvoHelper - Conversation Analyzer</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="dark-theme">
    <div id="app">
        <!-- Initial Loading State -->
        <div id="loading-screen" class="loading-screen">
            <div class="loading-content">
                <h1>üó®Ô∏è ConvoHelper</h1>
                <div class="spinner"></div>
                <p>Loading...</p>
            </div>
        </div>

        <!-- Main Application -->
        <div id="main-app" class="hidden">
            <!-- Header -->
            <header class="app-header">
                <div class="header-content">
                    <h1 class="app-title">üó®Ô∏è ConvoHelper</h1>
                    <div class="header-controls">
                        <select id="timezone-select" class="timezone-select" title="Timezone">
                            <option value="auto">Auto (GMT+0)</option>
                        </select>
                        <select id="person-jumper" class="person-jumper hidden">
                            <option value="">Jump to person...</option>
                        </select>
                        <button id="theme-toggle" class="btn-icon" title="Toggle theme">
                            <span class="theme-icon">‚òÄÔ∏è</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="app-main">
                <!-- Page: Upload -->
                <div id="page-upload" class="page active">
                    <div class="page-content">
                        <div class="upload-section">
                            <h2 class="section-title">üìÅ Upload Your Data</h2>
                            <p class="section-subtitle">Drop your conversation JSON file to get started!</p>
                            
                            <div id="drop-zone" class="drop-zone">
                                <input type="file" id="file-input" accept=".json" hidden>
                                <div class="drop-zone-content">
                                    <div class="drop-icon">üìÅ</div>
                                    <p class="drop-text">Drag & drop your JSON file here</p>
                                    <p class="drop-or">or</p>
                                    <button id="btn-choose-file" class="btn btn-primary">
                                        Choose File
                                    </button>
                                    <p class="drop-hint">Supports files up to 50MB</p>
                                </div>
                            </div>

                            <div id="upload-status" class="upload-status hidden"></div>
                            
                            <div id="identity-selector" class="identity-selector hidden">
                                <h3 class="selector-title">üë§ Select Your Identity</h3>
                                <p class="selector-subtitle">Choose which sender name represents you in the conversations</p>
                                <select id="identity-select" class="identity-select">
                                    <option value="">-- Select your identity --</option>
                                </select>
                                <p class="selector-hint">This will be used to calculate "You vs Them" statistics</p>
                            </div>
                            
                            <div id="upload-actions" class="upload-actions hidden">
                                <button id="btn-process" class="btn btn-primary btn-large">
                                    ‚ú® Process Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page: Processing -->
                <div id="page-processing" class="page">
                    <div class="page-content">
                        <div class="processing-section">
                            <h2 class="section-title">‚öôÔ∏è Processing Your Conversations</h2>
                            <p class="section-subtitle">This may take a moment for large files...</p>
                            
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div id="progress-fill" class="progress-fill"></div>
                                </div>
                                <p id="progress-text" class="progress-text">0%</p>
                            </div>

                            <div id="processing-steps" class="processing-steps">
                                <div class="step" data-step="parse">
                                    <span class="step-icon">‚è≥</span>
                                    <span class="step-text">Parsing JSON data...</span>
                                </div>
                                <div class="step" data-step="extract">
                                    <span class="step-icon">‚è≥</span>
                                    <span class="step-text">Extracting messages...</span>
                                </div>
                                <div class="step" data-step="cluster">
                                    <span class="step-icon">‚è≥</span>
                                    <span class="step-text">Clustering by weeks...</span>
                                </div>
                                <div class="step" data-step="group">
                                    <span class="step-icon">‚è≥</span>
                                    <span class="step-text">Grouping into months...</span>
                                </div>
                                <div class="step" data-step="stats">
                                    <span class="step-icon">‚è≥</span>
                                    <span class="step-text">Generating statistics...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page: Overview -->
                <div id="page-overview" class="page">
                    <div class="page-content">
                        <h2 class="section-title">üìä Overview Statistics</h2>
                        
                        <!-- Date Range Filter Bar -->
                        <div class="stats-filter-bar">
                            <div class="filter-group">
                                <label>View:</label>
                                <div class="btn-group">
                                    <button class="filter-btn active" data-view="all">All Time</button>
                                    <button class="filter-btn" data-view="month">By Month</button>
                                    <button class="filter-btn" data-view="week">By Week</button>
                                    <button class="filter-btn" data-view="custom">Custom Range</button>
                                </div>
                            </div>
                            <div class="filter-group hidden" id="period-selector">
                                <select id="period-select">
                                    <option value="">Select period...</option>
                                </select>
                            </div>
                            <div class="date-range-picker hidden" id="custom-range">
                                <div class="quick-presets">
                                    <button class="preset-btn" data-preset="7">Last 7 days</button>
                                    <button class="preset-btn" data-preset="30">Last 30 days</button>
                                    <button class="preset-btn" data-preset="90">Last 90 days</button>
                                    <button class="preset-btn" data-preset="year">This Year</button>
                                </div>
                                <div class="custom-dates">
                                    <input type="date" id="range-start" />
                                    <span>to</span>
                                    <input type="date" id="range-end" />
                                    <button id="apply-range" class="btn btn-primary btn-sm">Apply</button>
                                </div>
                            </div>
                            <div class="active-filter-indicator hidden" id="active-filter">
                                <span id="filter-description"></span>
                                <button id="clear-filter" class="btn-clear">‚úï</button>
                            </div>
                        </div>
                        
                        <div class="stats-cards">
                            <div class="stat-card">
                                <div class="stat-icon">üí¨</div>
                                <div class="stat-info">
                                    <div class="stat-label">Total Messages</div>
                                    <div id="stat-total-messages" class="stat-value">0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üë•</div>
                                <div class="stat-info">
                                    <div class="stat-label">Conversations</div>
                                    <div id="stat-total-convos" class="stat-value">0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üìÖ</div>
                                <div class="stat-info">
                                    <div class="stat-label">Date Range</div>
                                    <div id="stat-date-range" class="stat-value">-</div>
                                </div>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üìà Messages Over Time</h3>
                            <div class="chart-container">
                                <canvas id="chart-timeline"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üèÜ Top Conversations</h3>
                            <p class="chart-subtitle">Click any name to view details</p>
                            <div id="top-conversations" class="top-conversations"></div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">ü•ß Message Distribution</h3>
                            <div class="chart-container chart-container-small">
                                <canvas id="chart-distribution"></canvas>
                            </div>
                        </div>

                        <!-- Enhanced Analytics Sections -->
                        <div class="chart-section">
                            <h3 class="chart-title">üìÖ Activity by Day of Week</h3>
                            <div class="chart-container">
                                <canvas id="chart-day-of-week"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üéØ Peak Activity</h3>
                            <div class="stats-cards">
                                <div class="stat-card">
                                    <div class="stat-icon">üïê</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Peak Hour</div>
                                        <div id="peak-hour" class="stat-value">-</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üìÖ</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Peak Day</div>
                                        <div id="peak-day" class="stat-value">-</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üìÜ</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Peak Month</div>
                                        <div id="peak-month" class="stat-value">-</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">‚ö°</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Msg Velocity</div>
                                        <div id="msg-velocity" class="stat-value">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üí¨ Content Types</h3>
                            <div class="chart-container chart-container-small">
                                <canvas id="chart-content-types"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üìè Message Lengths</h3>
                            <div class="chart-container chart-container-small">
                                <canvas id="chart-msg-lengths"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">‚öñÔ∏è Conversation Balance</h3>
                            <p class="chart-subtitle">How balanced is each conversation? (50% = perfectly balanced)</p>
                            <div class="chart-container">
                                <canvas id="chart-balance"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üìä Conversation Density</h3>
                            <p class="chart-subtitle">Messages per day (relative to most active conversation)</p>
                            <div class="chart-container">
                                <canvas id="chart-density"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üî• Activity Heatmap - Hour √ó Day of Week</h3>
                            <p class="chart-subtitle">Message distribution by hour and day (bubble size = message count)</p>
                            <div class="chart-container chart-container-heatmap">
                                <canvas id="chart-heatmap-hour-day"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üìÜ Activity Heatmap - Day √ó Month</h3>
                            <p class="chart-subtitle">Message distribution by day of month across all months</p>
                            <div class="chart-container chart-container-heatmap">
                                <canvas id="chart-heatmap-month-day"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üî• Activity Categories</h3>
                            <div id="activity-categories" class="activity-categories"></div>
                        </div>
                    </div>
                </div>

                <!-- Page: Individual -->
                <div id="page-individual" class="page">
                    <div class="page-content">
                        <div class="page-nav">
                            <button id="btn-back-overview" class="btn btn-secondary">
                                ‚Üê Back to Overview
                            </button>
                            <select id="person-switcher" class="person-switcher">
                                <option value="">Select person...</option>
                            </select>
                        </div>

                        <div class="individual-header">
                            <h2 id="individual-name" class="individual-name">üë§ Person Name</h2>
                        </div>

                        <div class="stats-cards">
                            <div class="stat-card">
                                <div class="stat-icon">üí¨</div>
                                <div class="stat-info">
                                    <div class="stat-label">Total Messages</div>
                                    <div id="ind-total-messages" class="stat-value">0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üìä</div>
                                <div class="stat-info">
                                    <div class="stat-label">Percentage</div>
                                    <div id="ind-percentage" class="stat-value">0%</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üìÖ</div>
                                <div class="stat-info">
                                    <div class="stat-label">Avg per Day</div>
                                    <div id="ind-avg-day" class="stat-value">0</div>
                                </div>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üìä Messages by Month</h3>
                            <div class="chart-container">
                                <canvas id="chart-by-month"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üïê Activity by Hour</h3>
                            <div class="chart-container">
                                <canvas id="chart-by-hour"></canvas>
                            </div>
                        </div>

                        <!-- Enhanced Individual Analytics -->
                        <div class="chart-section">
                            <h3 class="chart-title">‚ö° Response Times</h3>
                            <div class="stats-cards">
                                <div class="stat-card">
                                    <div class="stat-icon">ü´µ</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Your Avg Response</div>
                                        <div id="your-avg-response" class="stat-value">-</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üë§</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Their Avg Response</div>
                                        <div id="their-avg-response" class="stat-value">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">‚öñÔ∏è Conversation Balance</h3>
                            <div class="stats-cards">
                                <div class="stat-card">
                                    <div class="stat-icon">üéØ</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Balance Score</div>
                                        <div id="balance-score" class="stat-value">-</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">ü´µ</div>
                                    <div class="stat-info">
                                        <div class="stat-label">You</div>
                                        <div id="you-percentage" class="stat-value">-</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üë§</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Them</div>
                                        <div id="them-percentage" class="stat-value">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üöÄ Conversation Initiator</h3>
                            <div class="stats-cards">
                                <div class="stat-card">
                                    <div class="stat-icon">ü´µ</div>
                                    <div class="stat-info">
                                        <div class="stat-label">You Initiated</div>
                                        <div id="you-initiated" class="stat-value">-</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üë§</div>
                                    <div class="stat-info">
                                        <div class="stat-label">They Initiated</div>
                                        <div id="them-initiated" class="stat-value">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üî• Streaks & Gaps</h3>
                            <div class="stats-cards">
                                <div class="stat-card">
                                    <div class="stat-icon">‚ö°</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Current Streak</div>
                                        <div id="current-streak" class="stat-value">-</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üèÜ</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Longest Streak</div>
                                        <div id="longest-streak" class="stat-value">-</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üò¥</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Longest Gap</div>
                                        <div id="longest-gap" class="stat-value">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üìù Message Profile</h3>
                            <div class="stats-cards">
                                <div class="stat-card">
                                    <div class="stat-icon">üìè</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Avg Words/Message</div>
                                        <div id="avg-words" class="stat-value">-</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">üìà</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Activity Trend</div>
                                        <div id="activity-trend" class="stat-value">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üìÖ Day of Week Preference</h3>
                            <div class="chart-container">
                                <canvas id="chart-ind-day-of-week"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üí¨ Content Types</h3>
                            <div class="chart-container chart-container-small">
                                <canvas id="chart-ind-content-types"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üìè Message Lengths</h3>
                            <div class="chart-container chart-container-small">
                                <canvas id="chart-ind-msg-lengths"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üéâ Milestones</h3>
                            <div id="milestones-list" class="milestones-list"></div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üí• Message Bursts</h3>
                            <p class="chart-subtitle">Rapid message exchanges (5+ messages within 30 minutes)</p>
                            <div id="message-bursts-list" class="bursts-list"></div>
                        </div>

                        <!-- Advanced Visualizations -->
                        <div class="chart-section">
                            <h3 class="chart-title">‚òÅÔ∏è Word Cloud</h3>
                            <p class="chart-subtitle">Most frequently used words in this conversation</p>
                            
                            <div class="viz-controls">
                                <div class="control-group">
                                    <label class="control-label">
                                        <input type="checkbox" id="wordcloud-include-phrases" checked>
                                        Include Phrases
                                    </label>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">N-gram Size:</label>
                                    <select id="wordcloud-ngram-size" class="control-select">
                                        <option value="2">2-grams (e.g., "thank you")</option>
                                        <option value="3">3-grams (e.g., "i love you")</option>
                                        <option value="4">4-grams</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">Min Occurrences:</label>
                                    <input type="number" id="wordcloud-min-occurrence" min="1" max="20" value="3" class="control-input">
                                </div>
                                <div class="control-group">
                                    <label class="control-label">Max Words:</label>
                                    <input type="number" id="wordcloud-max-words" min="20" max="200" value="100" step="10" class="control-input">
                                </div>
                                <button id="wordcloud-refresh" class="btn btn-sm btn-secondary">‚Üª Refresh</button>
                            </div>
                            
                            <div id="viz-wordcloud-container" class="viz-container"></div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üìÖ Activity Calendar</h3>
                            <p class="chart-subtitle">Daily message activity heatmap</p>
                            <div id="viz-calendar-container" class="viz-container"></div>
                        </div>

                        <div class="chart-section">
                            <h3 class="chart-title">üîÑ Conversation Flow</h3>
                            <p class="chart-subtitle">Message exchange patterns over time</p>
                            <div id="viz-flow-container" class="viz-container"></div>
                        </div>

                        <div class="timeline-section">
                            <h3 class="chart-title">üìÖ Timeline</h3>
                            <p class="chart-subtitle">Click months to expand/collapse weeks</p>
                            <div id="timeline-container" class="timeline-container"></div>
                        </div>

                        <div class="export-button-section">
                            <button id="btn-goto-export" class="btn btn-primary btn-large">
                                üíæ Export This Conversation
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Page: Export -->
                <div id="page-export" class="page">
                    <div class="page-content">
                        <div class="page-nav">
                            <button id="btn-back-individual" class="btn btn-secondary">
                                ‚Üê Back
                            </button>
                        </div>

                        <h2 class="section-title">üíæ Export Conversation</h2>
                        <p id="export-person-name" class="section-subtitle">Select what to export</p>

                        <div class="export-section">
                            <h3 class="export-section-title">üìÖ Select Time Periods</h3>
                            <p class="export-hint">Check months to select all weeks, or expand to select individual weeks</p>
                            <div id="export-timeline" class="export-timeline"></div>
                        </div>

                        <div class="export-summary">
                            <h3 class="export-section-title">üìä Selection Summary</h3>
                            <div class="summary-stats">
                                <div class="summary-stat">
                                    <span class="summary-label">Weeks selected:</span>
                                    <span id="summary-weeks" class="summary-value">0</span>
                                </div>
                                <div class="summary-stat">
                                    <span class="summary-label">Total messages:</span>
                                    <span id="summary-messages" class="summary-value">0</span>
                                </div>
                                <div class="summary-stat">
                                    <span class="summary-label">Files to create:</span>
                                    <span id="summary-files" class="summary-value">0</span>
                                </div>
                            </div>
                        </div>

                        <div class="export-actions">
                            <button id="btn-preview" class="btn btn-secondary">
                                üìÑ Preview
                            </button>
                            <button id="btn-export" class="btn btn-primary btn-large">
                                üíæ Download Export
                            </button>
                        </div>

                        <div id="preview-container" class="preview-container hidden">
                            <h3 class="export-section-title">üìÑ Preview</h3>
                            <div id="preview-content" class="preview-content"></div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="app-footer">
                <p>Made with ‚ù§Ô∏è using ConvoHelper Standalone Edition</p>
                <p class="footer-links">
                    <a href="README.md" target="_blank">Documentation</a> ‚Ä¢
                    <a href="USAGE.md" target="_blank">Usage Guide</a> ‚Ä¢
                    <a href="DATA_FORMAT.md" target="_blank">Data Format</a>
                </p>
            </footer>
        </div>
    </div>

    <!-- Message Toast -->
    <div id="toast" class="toast hidden">
        <span id="toast-message"></span>
    </div>

    <!-- Scripts -->
    <script src="libs/d3.min.js"></script>
    <script src="libs/chart.min.js"></script>
    <script src="libs/marked.min.js"></script>
    <script src="libs/jszip.min.js"></script>
    <script src="js/parser.js"></script>
    <script src="js/processor.js"></script>
    <script src="js/stats.js"></script>
    <script src="js/stats-general.js"></script>
    <script src="js/stats-individual.js"></script>
    <script src="js/stats-comparative.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/charts-heatmap.js"></script>
    <script src="js/exporter.js"></script>
    <script src="js/date-range-filter.js"></script>
    <script src="js/viz-utils.js"></script>
    <script src="js/viz-calendar.js"></script>
    <script src="js/viz-wordcloud.js"></script>
    <script src="js/viz-timeline.js"></script>
    <script src="js/viz-flow.js"></script>
    <script src="js/viz-privacy.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
